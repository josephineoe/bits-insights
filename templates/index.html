<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bits & Insights</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            background-color: #000;     
            color: #fff;             
            margin: 0;
            font-family: "Inter", sans-serif;
        }

        nav {
            padding: 18px 40px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        nav a {
            color: #fff;
            text-decoration: none;
            margin-left: 20px;
            font-size: 14px;
            opacity: 0.85;
        }
        nav a:hover {
            opacity: 1;
        }

        .hero {
            max-width: 900px;
            margin: 120px auto 60px auto;
            padding: 0 20px;
        }
        .hero-title {
            font-size: 40px;
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.3;
        }
        .hero-subtitle {
            font-size: 16px;
            color: #ccc;
            max-width: 600px;
            line-height: 1.6;
            margin-bottom: 40px;
        }

        .search-box {
            margin-top: 30px;
            max-width: 700px;
        }
        input, select {
            width: 100%;
            padding: 14px;
            margin-bottom: 14px;
            background: #000;
            border: 1px solid #555;
            color: #fff;
            font-size: 15px;
            border-radius: 4px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #fff;
        }

        button {
            width: 100%;
            padding: 14px;
            background: #fff;
            color: #000;
            font-weight: 600;
            font-size: 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #ccc;
        }

        footer {
            padding: 40px;
            text-align: center;
            font-size: 13px;
            color: #666;
            border-top: 1px solid #222;
            margin-top: 80px;
        }
    </style>
</head>

<body>

<nav>
    <div class="left">
        <strong>Bits & Insights</strong>
    </div>

    <div class="right">
        <a href="/browse">Browse</a>
        <a href="/forum">Forum</a>
        <a href="/favorites">Favorites</a>

        <!-- Log In link shown before login -->
        <a href="/login" id="login-link">Log In</a>

        <!-- Email + Logout shown after login -->
        <span id="user-email" style="font-size:13px; color:#aaa; margin-left:16px; display:none;"></span>
        <a href="#" id="logout-link" style="margin-left:12px; color:#f77; font-size:13px; display:none;">Logout</a>
    </div>
</nav>

<section class="hero">
    <div class="hero-title">
        Search. Read. Explore.<br>
        Academic Knowledge, Simplified.
    </div>

    <div class="hero-subtitle">
        A minimalistic scholarly search tool powered by the arXiv API.
        Find papers across AI, math, physics, and more — with focus and clarity.
    </div>

    <div class="search-box">
        <form action="/search" method="GET">
            <input name="query" type="text" placeholder="Search papers">
            <input name="author" type="text" placeholder="Author">
            
            <select name="category">
                <option value="">All Categories</option>
                <option value="cs.AI">cs.AI</option>
                <option value="cs.LG">cs.LG</option>
                <option value="math.PR">math.PR</option>
            </select>

            <button type="submit">Search</button>
        </form>
    </div>
</section>

<section class="hero" id="recent-section" style="display:none; margin-top: 20px;">
    <div class="hero-subtitle" style="margin-bottom: 10px;">
        Recently viewed
    </div>
    <ul id="recent-list" style="list-style: none; padding-left: 0; font-size: 14px; color: #ccc;"></ul>
</section>

<footer>
    © 2025 Bits & Insights · Built with Flask · Powered by arXiv API
</footer>

<!-- Firebase: Use the same config as login / detail / favorites -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAi7T7g8zFNYewd-6MSwMbl0qY4H1t7TSI",
    authDomain: "bits-insights.firebaseapp.com",
    projectId: "bits-insights",
    storageBucket: "bits-insights.firebasestorage.app",
    messagingSenderId: "977263721818",
    appId: "1:977263721818:web:4b2c5901fbcd9ccc97c763",
    measurementId: "G-J5QDM8RWM0"
    };

  if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
  }
  const auth = firebase.auth();

  const loginLink  = document.getElementById("login-link");
  const userEmail  = document.getElementById("user-email");
  const logoutLink = document.getElementById("logout-link");

  // Listen to login state changes and control display
  auth.onAuthStateChanged((user) => {
      if (user) {
          // Logged in: hide Log In, show email + Logout
          if (loginLink)  loginLink.style.display = "none";
          if (userEmail) {
              userEmail.style.display = "inline";
              userEmail.textContent = user.email;
          }
          if (logoutLink) logoutLink.style.display = "inline";
      } else {
          // Not logged in: show Log In, hide email + Logout
          if (loginLink)  loginLink.style.display = "inline";
          if (userEmail) {
              userEmail.style.display = "none";
              userEmail.textContent = "";
          }
          if (logoutLink) logoutLink.style.display = "none";
      }
  });

  // Logout button
  if (logoutLink) {
      logoutLink.addEventListener("click", async (e) => {
          e.preventDefault();
          try {
              await auth.signOut();
              // After logout, return to homepage (actually already on homepage, will refresh state)
              window.location.href = "/";
          } catch (err) {
              console.error("Logout error:", err);
          }
      });
  }
</script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  const db = firebase.firestore();
  const recentSection = document.getElementById("recent-section");
  const recentList = document.getElementById("recent-list");

  auth.onAuthStateChanged(async (user) => {
      // Keep your original nav login state control logic
      // Here additionally handle Recently viewed
      if (!user) {
          if (recentSection) recentSection.style.display = "none";
          if (recentList) recentList.innerHTML = "";
          return;
      }

      try {
          const snapshot = await db
            .collection("users")
            .doc(user.uid)
            .collection("recent")
            .orderBy("viewedAt", "desc")
            .limit(10)
            .get();

          if (snapshot.empty) {
              recentSection.style.display = "none";
              recentList.innerHTML = "";
              return;
          }

          recentList.innerHTML = "";
          snapshot.forEach(doc => {
              const data = doc.data();
              const li = document.createElement("li");
              li.style.marginBottom = "6px";

              const link = document.createElement("a");
              link.href = "/paper/" + (data.arxiv_id || doc.id);
              link.textContent = data.title || data.arxiv_id || doc.id;
              link.style.color = "#fff";
              link.style.textDecoration = "none";
              link.style.opacity = "0.9";

              link.onmouseover = () => link.style.textDecoration = "underline";
              link.onmouseout  = () => link.style.textDecoration = "none";

              li.appendChild(link);
              recentList.appendChild(li);
          });

          recentSection.style.display = "block";
      } catch (err) {
          console.error("Error loading recent views:", err);
          recentSection.style.display = "none";
      }
  });
</script>


</body>
</html>
